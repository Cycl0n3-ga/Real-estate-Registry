# åœ°åœ–åœ°å€åº§æ¨™é¡¯ç¤º - å¿«é€Ÿé–‹å§‹æŒ‡å—

## âœ¨ æ–°åŠŸèƒ½

å‰ç«¯ç¾åœ¨å¯ä»¥ä½¿ç”¨ **OpenStreetMap (OSM) åœ°ç†ç·¨ç¢¼** åŠŸèƒ½ï¼Œå°‡åœ°å€è‡ªå‹•è½‰æ›ç‚ºæº–ç¢ºçš„åº§æ¨™ï¼Œä¸¦åœ¨åœ°åœ–ä¸Šé¡¯ç¤ºæ­£ç¢ºä½ç½®ã€‚

### å·¥ä½œæµç¨‹

```
ç”¨æˆ¶æœå°‹åœ°å€
    â†“
å¾Œç«¯æŸ¥è©¢è³‡æ–™åº«ä¸¦è¿”å›äº¤æ˜“
    â†“
TaiwanGeocoder å°‡åœ°å€è½‰ç‚ºåº§æ¨™ â† ã€æ–°å¢ã€‘
    â†“
å‰ç«¯æ”¶åˆ°åº§æ¨™ (lat, lng)
    â†“
Leaflet åœ°åœ–åœ¨åº§æ¨™ä½ç½®é¡¯ç¤ºæ¨™è¨˜
    â†“
ç”¨æˆ¶é»æ“Šæ¨™è¨˜æŸ¥çœ‹è©³ç´°è³‡è¨Š
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å•Ÿå‹•ä¼ºæœå™¨

```bash
cd /home/cyclone/land/web
python3 server.py
```

ä¼ºæœå™¨æœƒè‡ªå‹•åˆå§‹åŒ– `TaiwanGeocoder`ã€‚

### 2. æ‰“é–‹å‰ç«¯

åœ¨ç€è¦½å™¨ä¸­è¨ªå•ï¼š
```
http://localhost:5001
```

### 3. æœå°‹åœ°å€

åœ¨æœå°‹æ¡†è¼¸å…¥åœ°å€ï¼Œä¾‹å¦‚ï¼š
- `ä¸‰æ°‘è·¯ 29 å··`
- `æ–‡åŒ–è·¯ä¸€æ®µ 100`
- `é¾å¯Œè·¯ 1 è™Ÿ`

### 4. æŸ¥çœ‹åœ°åœ–

æœå°‹çµæœæœƒåœ¨å³å´åœ°åœ–ä¸Šè‡ªå‹•é¡¯ç¤ºç‚ºå½©è‰²æ¨™è¨˜ï¼š
- ğŸŸ¢ **ç¶ è‰²**: å–®åƒ¹ â‰¤ 30 è¬/åª
- ğŸŸ¡ **é»ƒè‰²**: å–®åƒ¹ 30-60 è¬/åª  
- ğŸ”´ **ç´…è‰²**: å–®åƒ¹ > 60 è¬/åª

## ğŸ“Š åº§æ¨™ç²¾åº¦

| å±¤ç´š | ç²¾åº¦ | èªªæ˜ |
|------|------|------|
| é–€ç‰Œç´š | Â±10 ç±³ | æœ€ç²¾ç¢ºï¼ˆæœ‰ OSM é–€ç‰Œç´¢å¼•æ™‚ï¼‰ |
| è·¯æ®µç´š | Â±50 ç±³ | é€šé Nominatim APIï¼ˆé è¨­ï¼‰ |
| è¡Œæ”¿å€ç´š | Â±500 ç±³ | å›é€€æ–¹æ¡ˆ |

## ğŸ”§ é…ç½®

### ä¿®æ”¹ Geocoder è¨­å®š

ç·¨è¼¯ `server.py` ä¸­çš„ `init_geocoder()` å‡½æ•¸ï¼š

```python
def init_geocoder():
    global geocoder_engine, geocoder_ready
    try:
        geocoder_engine = TaiwanGeocoder(
            cache_dir=str(LAND_DIR / "db"),    # å¿«å–ç›®éŒ„
            provider="nominatim",              # ä½¿ç”¨ Nominatim
            concurrency=1                      # ä¸¦è¡Œæ•¸é‡
        )
        geocoder_ready = True
    except Exception as e:
        print(f"âŒ TaiwanGeocoder è¼‰å…¥å¤±æ•—: {e}")
        geocoder_ready = True
```

### ä½¿ç”¨æœ¬åœ° Nominatimï¼ˆå¯é¸ï¼‰

è¦æå‡æ•ˆèƒ½ï¼Œå¯éƒ¨ç½²æœ¬åœ° Nominatim å¯¦ä¾‹ï¼š

```python
geocoder_engine = TaiwanGeocoder(
    nominatim_url="http://localhost:8080"  # æœ¬åœ° Nominatim
)
```

## ğŸ—‚ï¸ ç›¸é—œæª”æ¡ˆ

```
/home/cyclone/land/
â”œâ”€â”€ web/
â”‚   â”œâ”€â”€ server.py           â† ä¸»è¦å¾Œç«¯ä¿®æ”¹ï¼ˆGeocoder æ•´åˆï¼‰
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ index.html      â† å‰ç«¯å·²æº–å‚™å¥½æ¥æ”¶åº§æ¨™
â”œâ”€â”€ land_reg/
â”‚   â””â”€â”€ geodecoding/
â”‚       â”œâ”€â”€ geocoder.py     â† TaiwanGeocoder æ ¸å¿ƒ
â”‚       â”œâ”€â”€ build_osm_index.py
â”‚       â””â”€â”€ README.md
â””â”€â”€ db/
    â””â”€â”€ geocode_cache.db    â† è‡ªå‹•å»ºç«‹çš„å¿«å–
```

## ğŸ“š API ç«¯é»

### æœå°‹åœ°å€

```bash
GET /api/search?keyword=<åœ°å€>&limit=<æ•¸é‡>&sort=<æ’åº>
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "total": 3,
  "transactions": [
    {
      "address": "å°åŒ—å¸‚æ¾å±±å€ä¸‰æ°‘è·¯43å··8è™Ÿåæ¨“ä¹‹1",
      "district": "æ¾å±±å€",
      "lat": 25.046084,
      "lng": 121.550550,
      "price": 15000000,
      "date": "2024/01/17",
      ...
    }
  ]
}
```

## ğŸ” æ•…éšœæ’é™¤

### åº§æ¨™é¡¯ç¤ºä¸æ­£ç¢º

**æª¢æŸ¥æ­¥é©Ÿ**:

1. æª¢æŸ¥ä¼ºæœå™¨æ—¥èªŒ
   ```bash
   tail -100 /tmp/server_geocoding.log
   ```

2. æ¸¬è©¦ Geocoder ç›´æ¥ä½¿ç”¨
   ```bash
   python3 << 'EOF'
   from geocoder import TaiwanGeocoder
   gc = TaiwanGeocoder()
   result = gc.geocode("å°åŒ—å¸‚å¤§å®‰å€å’Œå¹³æ±è·¯ä¸‰æ®µ1è™Ÿ")
   print(result)
   EOF
   ```

3. æ¸…é™¤å¿«å–é‡è©¦
   ```bash
   rm /home/cyclone/land/db/geocode_cache.db
   ```

### æœå°‹å¾ˆæ…¢

- ç¬¬ä¸€æ¬¡æŸ¥è©¢åœ°å€æ™‚æœƒé€£ç·šåˆ° Nominatim APIï¼ˆ1-2 ç§’ï¼‰
- å¾ŒçºŒæŸ¥è©¢æœƒä½¿ç”¨æœ¬åœ°å¿«å–ï¼ˆæ¯«ç§’ç´šï¼‰
- è€ƒæ…®éƒ¨ç½²æœ¬åœ° Nominatim å¯¦ä¾‹

## ğŸ“ˆ æ€§èƒ½æŒ‡æ¨™

- **åˆæ¬¡åœ°å€æŸ¥è©¢**: 1-2 ç§’ï¼ˆAPI èª¿ç”¨ï¼‰
- **å¿«å–æŸ¥è©¢**: <100 æ¯«ç§’
- **å‰ç«¯æ¨™è¨˜ç¹ªè£½**: <200 æ¯«ç§’
- **å¿«å–å¤§å°**: ~1-2 MBï¼ˆ1000 å€‹åœ°å€ï¼‰

## ğŸ¯ ä¸‹ä¸€æ­¥æ”¹é€²

- [ ] éƒ¨ç½²æœ¬åœ° Nominatim å¯¦ä¾‹
- [ ] åŸ·è¡Œ `build_osm_index.py` å»ºç«‹é–€ç‰Œç´šç´¢å¼•
- [ ] æ‰¹é‡é å…ˆç·¨ç¢¼å¸¸ç”¨åœ°å€
- [ ] æ·»åŠ åº§æ¨™æœå°‹åŠŸèƒ½ï¼ˆåå‘åœ°ç†ç·¨ç¢¼ï¼‰

---

æœ‰å•é¡Œæˆ–å»ºè­°ï¼ŸæŸ¥çœ‹ `OSM_GEOCODING_IMPLEMENTATION.md` ä»¥ç²å¾—æŠ€è¡“è©³æƒ…ã€‚
