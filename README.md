# ğŸ  Real Estate Registry â€” ä¸å‹•ç”¢å¯¦åƒ¹ç™»éŒ„æŸ¥è©¢ç³»çµ±

å…¨å°ç£ä¸å‹•ç”¢äº¤æ˜“å¯¦åƒ¹ç™»éŒ„è³‡æ–™æŸ¥è©¢ç³»çµ±ï¼Œæ”¯æ´åœ°å€æœå°‹ã€ç¯©é¸æ’åºã€å»ºæ¡ˆåç¨±åæŸ¥ç­‰åŠŸèƒ½ã€‚

![Python](https://img.shields.io/badge/python-3.8+-blue.svg)
![Flask](https://img.shields.io/badge/flask-3.0+-green.svg)
![SQLite](https://img.shields.io/badge/sqlite-3-blue.svg)

## âœ¨ åŠŸèƒ½ç‰¹è‰²

- ğŸ” **é—œéµå­—æœå°‹** â€” åœ°å€ã€å€åŸŸæ¨¡ç³Šæœå°‹ï¼Œæ”¯æ´å…¨å½¢/åŠå½¢æ•¸å­—è‡ªå‹•è½‰æ›
- ğŸ“Š **å¤šç¶­ç¯©é¸** â€” ç¸½åƒ¹ã€å–®åƒ¹ã€å¹´ä»½ã€åªæ•¸ã€å…¬è¨­æ¯”
- ğŸ“ˆ **æ’åºåŠŸèƒ½** â€” äº¤æ˜“ç­†æ•¸ã€å¹´ä»½ã€é¢ç©ã€å…¬è¨­æ¯”ã€ç¸½åƒ¹ã€å–®åƒ¹
- ğŸ˜ï¸ **å»ºæ¡ˆåç¨±æŸ¥è©¢** â€” åœ°å€ â†” å»ºæ¡ˆç¤¾å€åç¨±é›™å‘å°ç…§
- ğŸŒ **Web å‰ç«¯** â€” ç¾ä»£åŒ–éŸ¿æ‡‰å¼ UI

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Python 3.8+
- SQLite3

### å®‰è£

```bash
git clone https://github.com/Cycl0n3-ga/Real-estate-Registry.git
cd Real-estate-Registry

pip install flask flask-cors
```

### è³‡æ–™æº–å‚™

1. å°‡å…§æ”¿éƒ¨å¯¦åƒ¹ç™»éŒ„ CSVï¼ˆ`ALL_lvr_land_a.csv`ï¼‰æ”¾å…¥å°ˆæ¡ˆæ ¹ç›®éŒ„
2. åŸ·è¡Œè³‡æ–™è½‰æ›ï¼Œå»ºç«‹ SQLite è³‡æ–™åº«ï¼š

```bash
cd land_reg
python3 csv_to_sqlite.py
```

### å•Ÿå‹•ä¼ºæœå™¨

```bash
cd web
python3 server.py
```

ç€è¦½å™¨é–‹å•Ÿ **http://localhost:5001**

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

```
land/
â”œâ”€â”€ web/                          # ğŸŒ Web æ‡‰ç”¨
â”‚   â”œâ”€â”€ server.py                 #    Flask å¾Œç«¯ä¼ºæœå™¨ (port 5001)
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ index.html            #    å‰ç«¯æœå°‹é é¢
â”œâ”€â”€ land_reg/                     # ğŸ“¦ è³‡æ–™è™•ç†
â”‚   â”œâ”€â”€ csv_to_sqlite.py          #    CSV â†’ SQLite è½‰æ›å·¥å…·
â”‚   â”œâ”€â”€ address_search/           #    åœ°å€æœå°‹æ¨¡çµ„
â”‚   â”‚   â””â”€â”€ address_transfer.py   #    æ ¸å¿ƒæœå°‹å¼•æ“
â”‚   â””â”€â”€ geodecoding/              #    åœ°ç†ç·¨ç¢¼å·¥å…·
â”‚       â”œâ”€â”€ geocoder.py           #    åœ°å€ â†’ åº§æ¨™è½‰æ›
â”‚       â”œâ”€â”€ batch_geocode.py      #    æ‰¹æ¬¡åœ°ç†ç·¨ç¢¼
â”‚       â””â”€â”€ build_osm_index.py    #    OSM é–€ç‰Œç´¢å¼•å»ºç«‹
â”œâ”€â”€ address2com/                  # ğŸ  åœ°å€ â†’ å»ºæ¡ˆåç¨±
â”‚   â”œâ”€â”€ address2community.py      #    æŸ¥è©¢æ¨¡çµ„
â”‚   â”œâ”€â”€ build_db.py               #    å°ç…§è¡¨å»ºç«‹å·¥å…·
â”‚   â””â”€â”€ *.csv                     #    å°ç…§è³‡æ–™
â”œâ”€â”€ com2address/                  # ğŸ”„ å»ºæ¡ˆåç¨± â†’ åœ°å€
â”‚   â”œâ”€â”€ community2address.py      #    æŸ¥è©¢æ¨¡çµ„
â”‚   â””â”€â”€ 591_api_integration.py    #    591 API æ•´åˆ
â”œâ”€â”€ Building_Projects_B.csv       # ğŸ“‹ å»ºæ¡ˆ B è¡¨è³‡æ–™
â”œâ”€â”€ API_ä½¿ç”¨èªªæ˜.md                # ğŸ“– API æ–‡ä»¶
â””â”€â”€ .gitignore
```

## ğŸ“Š API ç«¯é»

### `GET /api/search`

æœå°‹äº¤æ˜“è³‡æ–™ï¼Œæ”¯æ´å¤šç¨®ç¯©é¸æ¢ä»¶ã€‚

| åƒæ•¸ | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| `keyword` | é—œéµå­—ï¼ˆåœ°å€/å€åŸŸï¼‰ | `keyword=å¤§ç›´` |
| `min_price` / `max_price` | ç¸½åƒ¹ç¯„åœï¼ˆå…ƒï¼‰ | `min_price=5000000` |
| `min_unit_price` / `max_unit_price` | å–®åƒ¹ç¯„åœï¼ˆå…ƒ/ã¡ï¼‰ | `max_unit_price=300000` |
| `min_year` / `max_year` | äº¤æ˜“å¹´ä»½ï¼ˆæ°‘åœ‹å¹´ï¼‰ | `min_year=110` |
| `min_area` / `max_area` | é¢ç©ç¯„åœï¼ˆã¡ï¼‰ | `min_area=50&max_area=100` |
| `min_ratio` / `max_ratio` | å…¬è¨­æ¯”ï¼ˆ%ï¼‰ | `max_ratio=30` |
| `sort_by` | æ’åºæ¬„ä½ | `sort_by=price` |
| `sort_order` | æ’åºæ–¹å‘ (`asc`/`desc`) | `sort_order=asc` |
| `limit` | ç­†æ•¸é™åˆ¶ | `limit=50` |

### `GET /api/address2community`

åœ°å€åæŸ¥å»ºæ¡ˆåç¨±ã€‚

| åƒæ•¸ | èªªæ˜ |
|------|------|
| `address` | æŸ¥è©¢åœ°å€ |

### `GET /api/stats`

å–å¾—è³‡æ–™åº«çµ±è¨ˆè³‡è¨Šã€‚

## ğŸ› ï¸ æŠ€è¡“æ¶æ§‹

- **å¾Œç«¯**ï¼šFlask + SQLite
- **å‰ç«¯**ï¼šåŸç”Ÿ HTML/CSS/JavaScript
- **è³‡æ–™ä¾†æº**ï¼šå…§æ”¿éƒ¨ä¸å‹•ç”¢äº¤æ˜“å¯¦åƒ¹ç™»éŒ„
- **è¼”åŠ©æ¨¡çµ„**ï¼šaddress2comï¼ˆåœ°å€â†’å»ºæ¡ˆï¼‰ã€com2addressï¼ˆå»ºæ¡ˆâ†’åœ°å€ï¼‰ã€address_matchï¼ˆåœ°å€æœå°‹ï¼‰

## âš¡ æ•ˆèƒ½å„ªåŒ–

æœ¬å°ˆæ¡ˆé‡å° 620 è¬ç­†äº¤æ˜“è³‡æ–™åº«é€²è¡Œç³»çµ±æ€§æ•ˆèƒ½å„ªåŒ–ï¼ŒæŸ¥è©¢é€Ÿåº¦æå‡ **100â€“500 å€**ã€‚

### ç´¢å¼•æ¶æ§‹

`finalize()` åŸ·è¡Œå¾Œæœƒè‡ªå‹•å»ºç«‹ 18 å€‹ç´¢å¼•ï¼š

| é¡å‹ | ç´¢å¼•åç¨± | æ¬„ä½ | ç”¨é€” |
|------|----------|------|------|
| å–®æ¬„ | `idx_county_city` | county_city | ç¸£å¸‚ç¯©é¸ |
| å–®æ¬„ | `idx_district` | district | è¡Œæ”¿å€ç¯©é¸ |
| å–®æ¬„ | `idx_street` | street | è·¯è¡—æœå°‹ |
| å–®æ¬„ | `idx_lane` | lane | å··å¼„æœå°‹ |
| å–®æ¬„ | `idx_number` | number | é–€ç‰Œæœå°‹ |
| å–®æ¬„ | `idx_floor` | floor | æ¨“å±¤ç¯©é¸ |
| å–®æ¬„ | `idx_date` | transaction_date | æ—¥æœŸæ’åº |
| å–®æ¬„ | `idx_price` | total_price | åƒ¹æ ¼æ’åº |
| å–®æ¬„ | `idx_serial` | serial_no | åºè™ŸæŸ¥è©¢ |
| å–®æ¬„ | `idx_dedup_key` | dedup_key | å»é‡æ¯”å° |
| å–®æ¬„ | `idx_community` | community_name | ç¤¾å€æŸ¥è©¢ |
| è¤‡åˆ | `idx_addr_combo` | county_city, district, street, lane, number | åœ°å€ç²¾æº–æŸ¥è©¢ |
| è¤‡åˆ | `idx_community_address` | community_name, address | ç¤¾å€â†’åœ°å€æŸ¥è©¢ |
| è¤‡åˆ | `idx_street_lane_district` | street, lane, district | è·¯å··å€è¤‡åˆæœå°‹ |
| è¤‡åˆ | `idx_search_numbers` | street, lane, district, total_floors, build_date | é€²éšæœå°‹ |
| è¤‡åˆ | `idx_district_street_number` | district, street, number | å€è·¯è™Ÿæœå°‹ |
| è¤‡åˆ | `idx_district_street_lane` | district, street, lane | å€åŸŸå··å¼„æœå°‹ |
| è¤‡åˆ | `idx_community_district` | community_name, district | ç¤¾å€+å€åŸŸæœå°‹ |

å¦æœ‰ FTS5 å…¨æ–‡æª¢ç´¢ç´¢å¼• (`address_fts`) ä½œç‚ºå›é€€æœå°‹ç­–ç•¥ã€‚

### æŸ¥è©¢ç­–ç•¥

**address2communityï¼ˆåœ°å€â†’å»ºæ¡ˆï¼‰** â€” 4 å±¤ç´¢å¼•æŸ¥è©¢ + LIKE å›é€€ï¼š
1. **ç²¾ç¢ºåŒ¹é…** â€” district + street + lane + number å®Œå…¨æ¯”å° (< 1ms)
2. **é–€ç‰Œæ¯”å°** â€” street + numberï¼Œå¿½ç•¥å··å¼„ (< 2ms)
3. **å··å¼„æœå°‹** â€” street + lane ç¯„åœæœå°‹ (< 5ms)
4. **è·¯æ®µæœå°‹** â€” åƒ… street æœå°‹ (< 10ms)
5. **LIKE å›é€€** â€” åŸå§‹åœ°å€æ¨¡ç³Šæ¯”å°ï¼ˆåƒ…åœ¨ç´¢å¼•éƒ½ç„¡çµæœæ™‚ä½¿ç”¨ï¼‰

**community2addressï¼ˆå»ºæ¡ˆâ†’åœ°å€ï¼‰** â€” è¼•é‡å•Ÿå‹• + æŒ‰éœ€æŸ¥è©¢ï¼š
- å•Ÿå‹•ï¼šåƒ…è¼‰å…¥ DISTINCT community_name (0.06sï¼Œå–ä»£åŸæœ¬ GROUP BY å…¨æƒ 3.7s)
- æŸ¥è©¢ï¼šä½¿ç”¨ `idx_community_address` ç´¢å¼•æŒ‰éœ€æŸ¥è©¢åœ°å€

**address_matchï¼ˆåœ°å€æœå°‹ï¼‰** â€” 3 å±¤æœå°‹ç­–ç•¥ï¼š
1. **çµæ§‹åŒ–æœå°‹** â€” è§£æåœ°å€æ¬„ä½èµ°ç´¢å¼• (æœ€å¿«)
2. **FTS5 å…¨æ–‡æœå°‹** â€” æ–‡å­—æ¯”å°åŸå§‹åœ°å€
3. **LIKE è®Šé«”æœå°‹** â€” æ•¸å­—æ ¼å¼è®Šé«”æ¨¡ç³Šæ¯”å°ï¼ˆæœ€å¾Œæ‰‹æ®µï¼‰

### æ•ˆèƒ½æ•¸æ“š

| æ“ä½œ | å„ªåŒ–å‰ | å„ªåŒ–å¾Œ | æå‡ |
|------|--------|--------|------|
| address2community å•Ÿå‹• | 4.5s | 0.1s | **45x** |
| address2community æŸ¥è©¢ | 200â€“1400ms | 0.1â€“6ms | **300x** |
| community2address å•Ÿå‹• | 3.7s | 0.06s | **60x** |
| community2address æŸ¥è©¢ | 100â€“230ms | ~25ms | **5â€“10x** |
| address_match çµæ§‹åŒ–æœå°‹ | N/A (èµ° LIKE) | < 50ms | **ç´¢å¼•ç›´æŸ¥** |
| convert.py è³‡æ–™è½‰æ› | ~14,000/s | ~22,000/s | **1.57x** |

### è‡ªå‹•å„ªåŒ–

åŸ·è¡Œ `convert.py` åŒ¯å…¥è³‡æ–™å¾Œï¼Œæœƒè‡ªå‹•åŸ·è¡Œ `finalize()`ï¼š
- å»ºç«‹æ‰€æœ‰ç´¢å¼•ï¼ˆ18 å€‹ï¼‰
- å»ºç«‹ FTS5 å…¨æ–‡æª¢ç´¢
- åŸ·è¡Œ ANALYZE æ›´æ–°æŸ¥è©¢è¦åŠƒå™¨çµ±è¨ˆ
- åŸ·è¡Œ VACUUM å£“ç¸®è³‡æ–™åº«ï¼ˆç£ç¢Ÿç©ºé–“ä¸è¶³æ™‚è‡ªå‹•è·³éï¼‰

è½‰æ›æ™‚ä½¿ç”¨ PRAGMA å„ªåŒ–æ‰¹é‡å¯«å…¥ï¼š
- `journal_mode=WAL` â€” å¯«å‰æ—¥èªŒï¼Œå…è¨±è®€å¯«ä½µç™¼
- `synchronous=OFF` â€” è½‰æ›æœŸé–“é—œé–‰åŒæ­¥ï¼ˆå®Œæˆå¾Œæ¢å¾©ï¼‰
- `cache_size=-256000` â€” 256MB è¨˜æ†¶é«”å¿«å–
- `temp_store=MEMORY` â€” æš«å­˜ä½¿ç”¨è¨˜æ†¶é«”
- `locking_mode=EXCLUSIVE` â€” ç¨ä½”é–å®šï¼Œæ¸›å°‘é–é–‹éŠ·
- å»¶é²ç´¢å¼•å»ºç«‹ â€” è½‰æ›å®Œæˆå¾Œæ‰å»ºç´¢å¼•ï¼Œé¿å…æ¯ç­†æ›´æ–°ç´¢å¼•

## ğŸ“„ æˆæ¬Š

MIT License
